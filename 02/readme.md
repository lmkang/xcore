### 02、保护模式  
a、从硬盘中读取loader到内存  
（1）先选择通道，往该通道的sector count寄存器中写入待操作的扇区数；  
（2）往该通道上的三个LBA寄存器写入扇区起始地址的低24位；  
（3）往device寄存器中写入LBA地址的27~24位，并设第6位为1（LBA模式），设第4位为0（master硬盘）；  
（4）往该通道上的command寄存器写入读取命令（0x20）；  
（5）读取该通道上的status寄存器，判断硬盘工作是否完成；  
（6）将硬盘数据读出。  
b、进入保护模式  
（1）打开A20Gate
```
in al, 0x92
or al, 0x02
out 0x92, al
```
（2）加载GDT
```
lgdt [GDT_PTR]
```
（3）清空流水线
```
jmp dword SELECTOR_CODE:p_mode_start
```
c、获取物理内存容量  
&emsp;&emsp;在Linux上有多种方法获取物理内存容量，如果一种方法失败了，就会用其他方法。我们可以学习Linux获取物理内存容量的方法。Linux本质上是通过调用BIOS中断0x15获取物理内存容量的，分别是0x15的3个子功能，子功能号要存放到寄存器EAX或AX中，按照内存信息的返回情况分别如下：
```
EAX=0xe820：遍历主机上的全部内存
AX=0xe801：分别检测低15MB和16MB~4GB的内存，最大支持4GB
AH=0x88：最多检测出64MB的内存，实际内存超过此容量也按照16MB返回
```
&emsp;&emsp;注意：BIOS中断是实模式下的功能，只能在进入保护模式前调用。

d、分页模式  

